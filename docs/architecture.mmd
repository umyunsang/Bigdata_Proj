%% Overall Architecture (Mermaid)
graph LR
  %% Sources
  subgraph Sources
    YT[YouTube Data API v3]
    SO[Social/User Events]
  end

  %% Ingest
  subgraph Ingest
    RS[Reservoir Sampling]
    BF[Bloom Filter (dedupe gate)]
    LAND[(Landing NDJSON)]
  end

  %% Bronze
  subgraph Bronze
    BR[(Bronze Delta<br/>partition: ingest_date, source)]
  end

  %% Silver
  subgraph Silver
    STR[Structured Streaming]
    WM[Watermark + Sliding Window]
    SIL[(Silver Delta: social_metrics)]
  end

  %% Gold
  subgraph Gold
    HLL[HLL / approx_count_distinct]
    CDF["CDF cutoff labeling (top p%)"]
    GLD[(Gold Features)]
  end

  %% Modeling
  subgraph Modeling
    M[LR / RF / GBT]
    PF[Pareto Front]
    AR[/artifacts: pareto.json/]
  end

  %% Serving
  subgraph Serving
    UI[Streamlit UI]
    PRED[(Predictions optional)]
  end

  %% Checkpointing
  CHK[/chk/silver/]

  %% Flows
  YT --> RS
  SO --> RS
  RS --> LAND
  LAND --> BF --> BR
  BR --> STR --> WM --> SIL
  SIL --> HLL --> CDF --> GLD
  GLD --> M --> PF --> AR
  GLD -. context .-> UI
  SIL -. context .-> UI
  PRED -. context .-> UI
  WM -. state .-> CHK

  %% Styling
  classDef store fill:#eef7ff,stroke:#1f6fb2,stroke-width:1px;
  class LAND,BR,SIL,GLD,PRED store;
