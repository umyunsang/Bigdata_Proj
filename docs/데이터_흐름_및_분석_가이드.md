# K-POP ì•„í‹°ìŠ¤íŠ¸ ì¸ê¸°ë„ ë¶„ì„ íŒŒì´í”„ë¼ì¸: ë°ì´í„° íë¦„ ê°€ì´ë“œ

> **ì‘ì„±ì¼**: 2025-10-24
> **í”„ë¡œì íŠ¸**: Bigdata_Proj - Video/Social Real-Time Pipeline
> **ëª©ì **: YouTube K-POP ë°ì´í„° ìˆ˜ì§‘ â†’ ë¶„ì„ â†’ ML ì˜ˆì¸¡ â†’ ì‹œê°í™” ì „ì²´ íë¦„ ì„¤ëª…

---

## ğŸ“‹ ëª©ì°¨

1. [í”„ë¡œì íŠ¸ ê°œìš”](#1-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ë°ì´í„° ìˆ˜ì§‘ (Landing)](#2-ë°ì´í„°-ìˆ˜ì§‘-landing)
3. [ë°ì´í„° ë¶„ì„ (Bronze â†’ Silver â†’ Gold)](#3-ë°ì´í„°-ë¶„ì„-bronze--silver--gold)
4. [ëª¨ë¸ í•™ìŠµ (Train)](#4-ëª¨ë¸-í•™ìŠµ-train)
5. [ì˜ˆì¸¡ ë° ì‹œê°í™” (UI)](#5-ì˜ˆì¸¡-ë°-ì‹œê°í™”-ui)
6. [ì‹¤í–‰ ì˜ˆì‹œ](#6-ì‹¤í–‰-ì˜ˆì‹œ)
7. [ë¹„ì¦ˆë‹ˆìŠ¤ í™œìš©](#7-ë¹„ì¦ˆë‹ˆìŠ¤-í™œìš©)

---

## 1. í”„ë¡œì íŠ¸ ê°œìš”

### ğŸ¯ í•µì‹¬ ì§ˆë¬¸
**"ì–´ë–¤ K-POP ì•„í‹°ìŠ¤íŠ¸ê°€ ë‹¤ìŒ ë°”ì´ëŸ´ ìŠ¤íƒ€ê°€ ë ê¹Œ?"**

### ğŸ“Š ë°ì´í„° íŒŒì´í”„ë¼ì¸ ì•„í‚¤í…ì²˜

```
YouTube Data API v3
        â†“
[Landing] Raw JSON (NDJSON)
        â†“ (Reservoir Sampling, Bloom Filter)
[Bronze] Delta Lake + Artist Extraction
        â†“
[Silver] Streaming Aggregation (Window + Watermark)
        â†“
[Gold] Feature Engineering + CDF Tier Labeling
        â†“ (HyperLogLog)
[Train] ML Model Training + Pareto Front Optimization
        â†“
[UI] Streamlit Dashboard (ì‹¤ì‹œê°„ ì˜ˆì¸¡)
```

### ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ
- **ë¹…ë°ì´í„° ì²˜ë¦¬**: Apache Spark 3.5.1, Delta Lake 3.2.0
- **ìŠ¤íŠ¸ë¦¬ë°**: Structured Streaming (Sliding Window + Watermark)
- **ë¨¸ì‹ ëŸ¬ë‹**: PySpark ML (Logistic Regression, Random Forest)
- **ì‹¤í—˜ ì¶”ì **: MLflow 3.4.0
- **ì‹œê°í™”**: Streamlit
- **ë°ì´í„° ì†ŒìŠ¤**: YouTube Data API v3

---

## 2. ë°ì´í„° ìˆ˜ì§‘ (Landing)

### ğŸ“¥ ë¬´ì—‡ì„ ìˆ˜ì§‘í•˜ë‚˜?

**YouTubeì—ì„œ K-POP ê´€ë ¨ ì˜ìƒ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘**

#### ìˆ˜ì§‘ ëª…ë ¹ì–´
```bash
python -m video_social_rtp.cli fetch \
    --query "NewJeans" \
    --max-items 50 \
    --reservoir-k 64 \
    --region-code KR \
    --relevance-language ko
```

#### ìˆ˜ì§‘ ë°ì´í„° êµ¬ì¡° (NDJSON)
```json
{
  "post_id": "search1_dQw4w9WgXcQ",
  "text": "NewJeans (ë‰´ì§„ìŠ¤) 'Ditto' Official MV",
  "video_id": "dQw4w9WgXcQ",
  "author_id": "UC2eCJnq0L3cEGAy9d2kWcww",
  "lang": "ko",
  "ts": 1729756800000,
  "source": "yt"
}
```

#### ì£¼ìš” í•„ë“œ
| í•„ë“œ | ì„¤ëª… | ì˜ˆì‹œ |
|------|------|------|
| `post_id` | ê²€ìƒ‰ ê²°ê³¼ ê³ ìœ  ID | `search1_dQw4w9WgXcQ` |
| `text` | ì˜ìƒ ì œëª© | `NewJeans 'Ditto' MV` |
| `video_id` | YouTube ì˜ìƒ ID | `dQw4w9WgXcQ` |
| `author_id` | ì±„ë„ ID | `UC2eCJnq...` |
| `lang` | ì–¸ì–´ ì½”ë“œ | `ko`, `en` |
| `ts` | íƒ€ì„ìŠ¤íƒ¬í”„ (ms) | `1729756800000` |

#### í•µì‹¬ ê¸°ìˆ : Reservoir Sampling
- **ëª©ì **: ëŒ€ëŸ‰ ë°ì´í„°ì—ì„œ ê· ë“± í™•ë¥ ë¡œ Kê°œ ìƒ˜í”Œ ì¶”ì¶œ
- **ì•Œê³ ë¦¬ì¦˜**: Vitter's Algorithm R
- **íŒŒë¼ë¯¸í„°**: `--reservoir-k 64` (64ê°œ ìƒ˜í”Œ ìœ ì§€)
- **ì¥ì **: ë©”ëª¨ë¦¬ íš¨ìœ¨ì  (O(k) ê³µê°„ ë³µì¡ë„)

#### ì €ì¥ ìœ„ì¹˜
```
project/data/landing/events_1729756800.json
```

---

## 3. ë°ì´í„° ë¶„ì„ (Bronze â†’ Silver â†’ Gold)

### ğŸ¥‰ Bronze Layer: ì¤‘ë³µ ì œê±° + ì•„í‹°ìŠ¤íŠ¸ ì¶”ì¶œ

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
python -m video_social_rtp.cli bronze
```

#### ì²˜ë¦¬ ê³¼ì •

**1ë‹¨ê³„: Bloom Filter ì¤‘ë³µ ì œê±°**
- **ëª©ì **: ì§€ë‚œ 7ì¼ê°„ ì´ë¯¸ ìˆ˜ì§‘í•œ `video_id` í•„í„°ë§
- **íŒŒë¼ë¯¸í„°**:
  - Capacity: 500,000
  - False Positive Rate: 0.01 (1%)
  - Lookback: 7ì¼
- **ì €ì¥ ìœ„ì¹˜**:
  - Binary: `project/artifacts/bronze_bloom.bin`
  - Metadata: `project/artifacts/bronze_bloom.json`

**2ë‹¨ê³„: ì•„í‹°ìŠ¤íŠ¸ ì¶”ì¶œ**
```python
# core/artists.py ë¡œì§
title = "NewJeans (ë‰´ì§„ìŠ¤) 'Ditto' Official MV"
channel_id = "UC2eCJnq0L3cEGAy9d2kWcww"

# 1. ì±„ë„ ID ìš°ì„  ë§¤ì¹­
if channel_id in OFFICIAL_CHANNELS:
    artist = OFFICIAL_CHANNELS[channel_id]  # "NEWJEANS"

# 2. ì œëª© íŒ¨í„´ ë§¤ì¹­ (30+ ì•„í‹°ìŠ¤íŠ¸)
else:
    for canonical, patterns in ARTIST_PATTERNS.items():
        if any(pattern in title.lower() for pattern in patterns):
            artist = canonical  # "NEWJEANS"

# 3. ê¸°ë³¸ê°’
else:
    artist = "OTHER"
```

**ì§€ì› ì•„í‹°ìŠ¤íŠ¸ (30+)**:
- BTS, BLACKPINK, TWICE, NEWJEANS, AESPA
- LESSERAFIM, IVE, ITZY, NMIXX, SEVENTEEN
- NCT, STRAYKIDS, ATEEZ, ENHYPEN, RIIZE
- ZEROBASEONE, KEPLER, BABYMONSTER ë“±

#### Bronze ìŠ¤í‚¤ë§ˆ
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `post_id` | String | ê³ ìœ  ID |
| `text` | String | ì˜ìƒ ì œëª© |
| `video_id` | String | YouTube ID |
| `author_id` | String | ì±„ë„ ID |
| `lang` | String | ì–¸ì–´ |
| `ts` | Long | íƒ€ì„ìŠ¤íƒ¬í”„ (ms) |
| `source` | String | ë°ì´í„° ì†ŒìŠ¤ (`yt`) |
| `artist` | String | **ì¶”ì¶œëœ ì•„í‹°ìŠ¤íŠ¸ëª…** |
| `ingest_date` | String | **íŒŒí‹°ì…˜ í‚¤** (YYYY-MM-DD) |

#### ì €ì¥ ìœ„ì¹˜ (Delta Lake)
```
project/data/bronze/
  â”œâ”€â”€ ingest_date=2025-10-16/
  â”‚   â”œâ”€â”€ artist=NEWJEANS/
  â”‚   â”œâ”€â”€ artist=BTS/
  â”‚   â””â”€â”€ artist=BLACKPINK/
  â””â”€â”€ ingest_date=2025-10-17/
      â””â”€â”€ artist=NEWJEANS/
```

---

### ğŸ¥ˆ Silver Layer: ìŠ¤íŠ¸ë¦¬ë° ìœˆë„ìš° ì§‘ê³„

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
python -m video_social_rtp.cli silver --once
```

#### Structured Streaming ì„¤ì •
- **ìœˆë„ìš°**: 1ì‹œê°„ (Window: 1 hour)
- **ìŠ¬ë¼ì´ë“œ**: 5ë¶„ (Slide: 5 minutes)
- **ì›Œí„°ë§ˆí¬**: 10ë¶„ (Watermark: 10 minutes)
- **íŠ¸ë¦¬ê±°**: `availableNow` (ë°°ì¹˜ ëª¨ë“œ)

#### ìœˆë„ìš° ì§‘ê³„ ë¡œì§
```python
# silver/stream.py í•µì‹¬ ë¡œì§
df = (
    bronze_stream
    .withWatermark("event_time", "10 minutes")
    .groupBy(
        window(col("event_time"), "1 hour", "5 minutes"),
        col("artist")
    )
    .agg(
        count("*").alias("video_count"),
        countDistinct("video_id").alias("unique_videos"),
        sum("engagement_score").alias("total_engagement"),
        approx_count_distinct("author_id").alias("unique_authors")  # HyperLogLog
    )
)
```

#### HyperLogLog ê·¼ì‚¬ ì¹´ìš´íŒ…
- **ëª©ì **: ë©”ëª¨ë¦¬ íš¨ìœ¨ì ìœ¼ë¡œ ê³ ìœ  ê°’ ê°œìˆ˜ ì¶”ì •
- **í•¨ìˆ˜**: `approx_count_distinct()`
- **ì •í™•ë„**: Â±2% ì˜¤ì°¨ (ê¸°ë³¸ê°’)
- **ë©”ëª¨ë¦¬**: O(log log n) vs O(n) for exact count

#### Silver ìŠ¤í‚¤ë§ˆ
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `window` | Struct | `{start, end}` íƒ€ì„ìŠ¤íƒ¬í”„ |
| `artist` | String | ì•„í‹°ìŠ¤íŠ¸ëª… |
| `video_count` | Long | ìœˆë„ìš° ë‚´ ì´ë²¤íŠ¸ ìˆ˜ |
| `unique_videos` | Long | ê³ ìœ  ì˜ìƒ ìˆ˜ |
| `total_engagement` | Double | ì´ ì°¸ì—¬ë„ ì ìˆ˜ |
| `unique_authors` | Long | HLL ì¶”ì • ê³ ìœ  ì±„ë„ ìˆ˜ |

#### ìœˆë„ìš° ì˜ˆì‹œ
```
Window 1: 09:00-10:00 â†’ NEWJEANS: 15 videos, engagement 450
Window 2: 09:05-10:05 â†’ NEWJEANS: 16 videos, engagement 480
Window 3: 09:10-10:10 â†’ NEWJEANS: 14 videos, engagement 420
```

#### ì €ì¥ ìœ„ì¹˜
- **Delta Table**: `project/data/silver/`
- **Checkpoint**: `project/chk/silver/`

---

### ğŸ¥‡ Gold Layer: í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§ + Tier ë¶„ë¥˜

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
python -m video_social_rtp.cli gold --top-pct 0.9
```

#### í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§

**1. ê¸°ë³¸ í†µê³„ í”¼ì²˜**
```python
# features/gold.py ì§‘ê³„ ë¡œì§
artist_features = (
    silver_df
    .groupBy("artist")
    .agg(
        sum("total_engagement").alias("total_engagement"),
        avg("total_engagement").alias("avg_engagement"),
        max("total_engagement").alias("max_engagement"),
        sum("unique_videos").alias("total_videos"),
        sum("unique_authors").alias("unique_viewers_est")
    )
)
```

**2. íŠ¸ë Œë“œ í”¼ì²˜** (30ì¼ ë°ì´í„° í•„ìš”)
```python
# 7ì¼ vs 30ì¼ ì„±ì¥ë¥ 
growth_rate_7d = (recent_7d - prev_7d) / prev_7d * 100
growth_rate_30d = (recent_30d - prev_30d) / prev_30d * 100

# ê°€ì†ë„ (momentum)
momentum = growth_rate_7d - growth_rate_30d

# ë³€ë™ì„± (volatility)
volatility = stddev(daily_engagement)
```

**3. ì‹œì¥ ì§€í‘œ**
```python
# ì‹œì¥ ì ìœ ìœ¨
market_share = artist_engagement / total_market_engagement * 100

# CDF ë°±ë¶„ìœ„ìˆ˜
percentile = cdf(artist_engagement)
```

#### CDF ê¸°ë°˜ Tier ë¶„ë¥˜

**ëˆ„ì  ë¶„í¬ í•¨ìˆ˜ (CDF) ê³„ì‚°**
```python
from pyspark.sql.window import Window

# Engagement ê¸°ì¤€ ì •ë ¬
window_spec = Window.orderBy("total_engagement")

# CDF ê³„ì‚°
gold_df = gold_df.withColumn(
    "percentile",
    percent_rank().over(window_spec)
)

# Tier í• ë‹¹ (--top-pct 0.9 = ìƒìœ„ 10%ê°€ Tier 1)
gold_df = gold_df.withColumn(
    "tier",
    when(col("percentile") >= 0.90, 1)  # ìƒìœ„ 10%
    .when(col("percentile") >= 0.75, 2)  # ìƒìœ„ 10~25%
    .when(col("percentile") >= 0.40, 3)  # ìƒìœ„ 25~60%
    .otherwise(4)                         # í•˜ìœ„ 40%
)
```

**Tier ì˜ë¯¸**:
- **Tier 1**: ì´ˆëŒ€í˜• ë°”ì´ëŸ´ ì•„í‹°ìŠ¤íŠ¸ (ìƒìœ„ 10%)
- **Tier 2**: ëŒ€í˜• ì¸ê¸° ì•„í‹°ìŠ¤íŠ¸ (ìƒìœ„ 10~25%)
- **Tier 3**: ì¤‘ê²¬ ì•„í‹°ìŠ¤íŠ¸ (ìƒìœ„ 25~60%)
- **Tier 4**: ì‹ ì¸/ì†Œê·œëª¨ ì•„í‹°ìŠ¤íŠ¸ (í•˜ìœ„ 40%)

#### Trend Direction ë¶„ë¥˜
```python
trend_direction = (
    when(col("growth_rate_7d") > 10, "RISING")      # ì„±ì¥ ì¤‘
    .when(col("growth_rate_7d") < -10, "FALLING")   # í•˜ë½ ì¤‘
    .otherwise("STEADY")                             # ì•ˆì •ì 
)
```

#### Gold ìŠ¤í‚¤ë§ˆ
| ì»¬ëŸ¼ | íƒ€ì… | ì„¤ëª… |
|------|------|------|
| `artist` | String | ì•„í‹°ìŠ¤íŠ¸ëª… |
| `total_engagement` | Double | ì´ ì°¸ì—¬ë„ |
| `avg_engagement` | Double | í‰ê·  ì°¸ì—¬ë„ |
| `max_engagement` | Double | ìµœëŒ€ ì°¸ì—¬ë„ |
| `total_videos` | Double | ì´ ì˜ìƒ ìˆ˜ |
| `unique_viewers_est` | Double | HLL ì¶”ì • ì‹œì²­ì ìˆ˜ |
| `growth_rate_7d` | Double | 7ì¼ ì„±ì¥ë¥  (%) |
| `growth_rate_30d` | Double | 30ì¼ ì„±ì¥ë¥  (%) |
| `momentum` | Double | ê°€ì†ë„ |
| `volatility` | Double | ë³€ë™ì„± |
| `market_share` | Double | ì‹œì¥ ì ìœ ìœ¨ (%) |
| `percentile` | Double | CDF ë°±ë¶„ìœ„ìˆ˜ (0~1) |
| `tier` | Integer | Tier ë“±ê¸‰ (1~4) |
| `trend_direction` | String | ì¶”ì„¸ (RISING/STEADY/FALLING) |

#### ì‹¤ì œ ë°ì´í„° ì˜ˆì‹œ (2025-10-16 ì‹¤í–‰ ê²°ê³¼)
```csv
artist,total_engagement,total_videos,percentile,tier,trend_direction
BLACKPINK,926,37,1.0,1,STEADY
BTS,281,15,0.5,4,STEADY
OTHER,71,4,0.0,4,STEADY
```

#### ì €ì¥ ìœ„ì¹˜
- **Delta Table**: `project/data/gold/features/`
- **CSV Export**: `project/data/gold/features.csv`
- **Tier Cutoffs**: `project/artifacts/gold_tiers.json`

---

## 4. ëª¨ë¸ í•™ìŠµ (Train)

### ğŸ¤– ML ëª©í‘œ: Tier ë“±ê¸‰ ì˜ˆì¸¡

#### ì‹¤í–‰ ëª…ë ¹ì–´ (MLflow í™œì„±í™”)
```bash
python -m video_social_rtp.cli train
```

**ì¤‘ìš”**: `--no-mlflow` í”Œë˜ê·¸ë¥¼ **ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”**! MLflowë¡œ ì‹¤í—˜ ì¶”ì ì´ í•„ìš”í•©ë‹ˆë‹¤.

#### í•™ìŠµ ë°ì´í„° ì¤€ë¹„

**í”¼ì²˜ (X)**:
```python
feature_cols = [
    "total_engagement",
    "avg_engagement",
    "total_videos",
    "unique_viewers_est",
    "growth_rate_7d",
    "growth_rate_30d",
    "momentum",
    "volatility"
]
```

**ë ˆì´ë¸” (y)**:
```python
# Tier (1~4) â†’ 0-indexed label
dataset = dataset.withColumn(
    "tier_idx",
    (col("tier") - 1).cast("double")
)
# tier_idx: 0 (Tier 1), 1 (Tier 2), 2 (Tier 3), 3 (Tier 4)
```

**Train/Test Split**:
- Train: 80% (random split, seed=42)
- Test: 20%

#### ëª¨ë¸ í•™ìŠµ (Multinomial Classification)

**Model 1: Logistic Regression**
```python
logreg = LogisticRegression(
    featuresCol="features",
    labelCol="tier_idx",
    maxIter=120,
    regParam=0.01,
    family="multinomial"  # 4-class classification
)
```

**Model 2: Random Forest**
```python
rf = RandomForestClassifier(
    featuresCol="features",
    labelCol="tier_idx",
    numTrees=250,
    maxDepth=12,
    seed=42
)
```

#### í‰ê°€ ì§€í‘œ

```python
metrics = {
    "accuracy": MulticlassClassificationEvaluator(
        labelCol="tier_idx",
        metricName="accuracy"
    ),
    "f1": MulticlassClassificationEvaluator(
        labelCol="tier_idx",
        metricName="f1"
    )
}
```

ì¶”ê°€ ê³„ì‚°:
- **Inference Latency**: 1000ê±´ ì˜ˆì¸¡ í‰ê·  ì‹œê°„ (ms)
- **Feature Count**: ì‚¬ìš©ëœ í”¼ì²˜ ê°œìˆ˜

#### MLflow ì‹¤í—˜ ì¶”ì 

```python
import mlflow

mlflow.set_tracking_uri("file://project/artifacts/mlruns")
mlflow.set_experiment("train_pareto")

with mlflow.start_run(run_name="LogisticRegression"):
    mlflow.log_param("model_type", "logreg")
    mlflow.log_param("max_iter", 120)
    mlflow.log_param("reg_param", 0.01)

    mlflow.log_metric("accuracy", 0.85)
    mlflow.log_metric("f1", 0.83)
    mlflow.log_metric("latency_ms", 5.2)

    mlflow.spark.log_model(model, "model")
```

#### MLflow UI ì ‘ì†
```bash
cd project/artifacts
mlflow ui --port 5000
```
ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:5000` ì ‘ì†

#### Pareto Front ìµœì í™”

**ë‹¤ëª©ì  ìµœì í™” ëª©í‘œ**:
- **Maximize**: accuracy, f1
- **Minimize**: latency_ms, feat_count

**Dominance íŒì •**:
```python
def dominates(model_a, model_b):
    # Aê°€ Bë¥¼ ì§€ë°°í•˜ë ¤ë©´:
    # 1. ëª¨ë“  ì§€í‘œì—ì„œ A â‰¥ B (accuracy, f1 ë†’ê³  latency, feat_count ë‚®ìŒ)
    # 2. ìµœì†Œ í•˜ë‚˜ì˜ ì§€í‘œì—ì„œ A > B (strictly better)
    better_or_equal = (
        a["f1"] >= b["f1"] and
        a["accuracy"] >= b["accuracy"] and
        a["latency_ms"] <= b["latency_ms"] and
        a["feat_count"] <= b["feat_count"]
    )
    strictly_better = (
        a["f1"] > b["f1"] or
        a["accuracy"] > b["accuracy"] or
        a["latency_ms"] < b["latency_ms"] or
        a["feat_count"] < b["feat_count"]
    )
    return better_or_equal and strictly_better
```

**Pareto Front ì„ íƒ**:
```python
pareto_models = [
    model for model in all_models
    if not any(dominates(other, model) for other in all_models)
]
```

#### ê²°ê³¼ ì €ì¥ (pareto.json)
```json
{
  "results": [
    {
      "model": "LogisticRegression",
      "accuracy": 0.85,
      "f1": 0.83,
      "latency_ms": 5.2,
      "feat_count": 8,
      "train_count": 240,
      "test_count": 60
    },
    {
      "model": "RandomForest",
      "accuracy": 0.92,
      "f1": 0.90,
      "latency_ms": 15.3,
      "feat_count": 8,
      "train_count": 240,
      "test_count": 60
    }
  ],
  "pareto": [
    {
      "model": "RandomForest",
      "is_pareto": true,
      "reason": "Highest accuracy/f1, acceptable latency"
    }
  ]
}
```

#### ì €ì¥ ìœ„ì¹˜
- **Pareto ê²°ê³¼**: `project/artifacts/pareto.json`
- **MLflow Runs**: `project/artifacts/mlruns/`
- **ëª¨ë¸ ì•„í‹°íŒ©íŠ¸**: MLflow tracking (Spark ML Pipeline)

---

## 5. ì˜ˆì¸¡ ë° ì‹œê°í™” (UI)

### ğŸ“Š Streamlit ëŒ€ì‹œë³´ë“œ

#### ì‹¤í–‰ ëª…ë ¹ì–´
```bash
python -m video_social_rtp.cli ui --port 8501
```

ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:8501` ì ‘ì†

---

### ëŒ€ì‹œë³´ë“œ ì£¼ìš” ê¸°ëŠ¥

#### 1ï¸âƒ£ Top-K ì•„í‹°ìŠ¤íŠ¸ ë­í‚¹

**ë°ì´í„° ì†ŒìŠ¤**: `project/data/gold/features.csv`

**ì‹œê°í™”**:
```python
import streamlit as st
import pandas as pd

df = pd.read_csv("project/data/gold/features.csv")
top10 = df.nlargest(10, "total_engagement")

# Tierë³„ ìƒ‰ìƒ ë§¤í•‘
tier_colors = {1: "ğŸ¥‡", 2: "ğŸ¥ˆ", 3: "ğŸ¥‰", 4: "âšª"}

for idx, row in top10.iterrows():
    st.write(f"{tier_colors[row['tier']]} {row['artist']}")
    st.progress(row['total_engagement'] / df['total_engagement'].max())
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
ğŸ¥‡ BLACKPINK        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘ 926
ğŸ¥‰ NEWJEANS        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘ 450
âšª BTS             â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 281
```

---

#### 2ï¸âƒ£ CDF/PDF ë¶„í¬ ì°¨íŠ¸

**CDF (Cumulative Distribution Function)**:
```python
import matplotlib.pyplot as plt
import numpy as np

engagements = df['total_engagement'].sort_values()
cdf = np.arange(1, len(engagements) + 1) / len(engagements)

fig, ax = plt.subplots()
ax.plot(engagements, cdf, label='CDF')
ax.axhline(y=0.90, color='gold', linestyle='--', label='Tier 1 cutoff')
ax.axhline(y=0.75, color='silver', linestyle='--', label='Tier 2 cutoff')
ax.axhline(y=0.40, color='brown', linestyle='--', label='Tier 3 cutoff')
ax.set_xlabel('Total Engagement')
ax.set_ylabel('Cumulative Probability')
st.pyplot(fig)
```

**PDF (Probability Density Function)**:
```python
hist, bins = np.histogram(engagements, bins=30, density=True)
ax.bar(bins[:-1], hist, width=np.diff(bins), alpha=0.6, label='PDF')
```

---

#### 3ï¸âƒ£ Bloom Filter ì¤‘ë³µ ì²´í¬

**ì…ë ¥ í¼**:
```python
video_id = st.text_input("Video ID ì…ë ¥:", "dQw4w9WgXcQ")

if st.button("ì¤‘ë³µ í™•ì¸"):
    bloom = BloomFilter.from_file("project/artifacts/bronze_bloom.bin")

    if video_id in bloom:
        st.warning("âš ï¸ ì´ë¯¸ ìˆ˜ì§‘ëœ ì˜ìƒì…ë‹ˆë‹¤ (ì§€ë‚œ 7ì¼ ë‚´)")
        st.caption(f"False Positive Rate: {bloom.error_rate:.2%}")
    else:
        st.success("âœ… ìƒˆë¡œìš´ ì˜ìƒì…ë‹ˆë‹¤")
```

**Bloom Filter í†µê³„**:
- Capacity: 500,000
- Current Count: 12,450
- FPR: 0.01 (1%)
- Size: 2.4 MB

---

#### 4ï¸âƒ£ ì•„í‹°ìŠ¤íŠ¸ íŠ¸ë Œë“œ ë¶„ì„

**ì„±ì¥ë¥  ì°¨íŠ¸**:
```python
trend_df = df[df['artist'].isin(['NEWJEANS', 'BLACKPINK', 'BTS'])]

fig, ax = plt.subplots()
for artist in trend_df['artist'].unique():
    artist_data = trend_df[trend_df['artist'] == artist]
    ax.plot(
        ['7d', '30d'],
        [artist_data['growth_rate_7d'].values[0],
         artist_data['growth_rate_30d'].values[0]],
        marker='o',
        label=artist
    )

ax.set_ylabel('Growth Rate (%)')
ax.set_title('ì•„í‹°ìŠ¤íŠ¸ë³„ ì„±ì¥ë¥  ì¶”ì´')
ax.legend()
st.pyplot(fig)
```

**Momentum ì§€í‘œ**:
```python
momentum_df = df[['artist', 'momentum', 'trend_direction']]

# Momentum > 5: ğŸš€ ê¸‰ì„±ì¥
# -5 < Momentum < 5: â¸ï¸ ì•ˆì •
# Momentum < -5: ğŸ“‰ í•˜ë½
```

---

#### 5ï¸âƒ£ Tier ì˜ˆì¸¡ ì‹œë®¬ë ˆì´í„°

**ì…ë ¥ í¼**:
```python
st.subheader("ğŸ”® ìƒˆ ì•„í‹°ìŠ¤íŠ¸ Tier ì˜ˆì¸¡")

col1, col2 = st.columns(2)
with col1:
    total_engagement = st.number_input("Total Engagement", 0, 2000, 500)
    total_videos = st.number_input("Total Videos", 0, 100, 20)
    growth_7d = st.slider("Growth Rate 7d (%)", -50, 100, 10)
    growth_30d = st.slider("Growth Rate 30d (%)", -50, 100, 15)

with col2:
    avg_engagement = total_engagement / total_videos
    momentum = growth_7d - growth_30d
    volatility = st.number_input("Volatility", 0.0, 100.0, 10.0)
    unique_viewers = st.number_input("Unique Viewers", 0, 500, 100)
```

**ì˜ˆì¸¡ ì‹¤í–‰**:
```python
if st.button("ì˜ˆì¸¡í•˜ê¸°"):
    # Load Pareto-optimal model from MLflow
    import mlflow.spark

    model_uri = "runs:/<run_id>/model"
    model = mlflow.spark.load_model(model_uri)

    # í”¼ì²˜ ë²¡í„° ìƒì„±
    features = spark.createDataFrame([(
        total_engagement,
        avg_engagement,
        total_videos,
        unique_viewers,
        growth_7d,
        growth_30d,
        momentum,
        volatility
    )], schema=feature_schema)

    # ì˜ˆì¸¡
    prediction = model.transform(features)
    predicted_tier = int(prediction.select("prediction").first()[0]) + 1

    # ê²°ê³¼ í‘œì‹œ
    tier_emoji = {1: "ğŸ¥‡", 2: "ğŸ¥ˆ", 3: "ğŸ¥‰", 4: "âšª"}
    st.success(f"ì˜ˆì¸¡ Tier: {tier_emoji[predicted_tier]} Tier {predicted_tier}")

    if predicted_tier == 1:
        st.balloons()
        st.write("ğŸ”¥ ë°”ì´ëŸ´ ê°€ëŠ¥ì„± ë§¤ìš° ë†’ìŒ!")
```

---

#### 6ï¸âƒ£ Pareto Front ëª¨ë¸ ë¹„êµ

**ëª¨ë¸ ì„±ëŠ¥ í…Œì´ë¸”**:
```python
import json

with open("project/artifacts/pareto.json") as f:
    pareto_data = json.load(f)

results_df = pd.DataFrame(pareto_data["results"])
st.dataframe(results_df)
```

**Pareto Front ê·¸ë˜í”„**:
```python
fig, ax = plt.subplots()

for model in pareto_data["results"]:
    color = 'red' if model in pareto_data["pareto"] else 'blue'
    marker = 'o' if model in pareto_data["pareto"] else 'x'

    ax.scatter(
        model["latency_ms"],
        model["accuracy"],
        c=color,
        marker=marker,
        s=100,
        label=model["model"]
    )

ax.set_xlabel("Inference Latency (ms)")
ax.set_ylabel("Accuracy")
ax.set_title("Pareto Front: Accuracy vs Latency")
ax.legend()
st.pyplot(fig)
```

---

## 6. ì‹¤í–‰ ì˜ˆì‹œ

### ğŸš€ ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

#### Step 1: í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
source .venv/bin/activate

# ë””ë ‰í† ë¦¬ ìƒì„±
python -m video_social_rtp.cli scaffold
```

#### Step 2: ë°ì´í„° ìˆ˜ì§‘ (Day 1-30)
```bash
# ë§¤ì¼ 2íšŒ ì‹¤í–‰ (ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 3ì‹œ)
python -m video_social_rtp.cli fetch --query "NewJeans" --region-code KR
python -m video_social_rtp.cli fetch --query "BTS official" --region-code KR
python -m video_social_rtp.cli fetch --query "BLACKPINK" --region-code KR
```

#### Step 3: Bronze ì²˜ë¦¬ (ë§¤ì¼)
```bash
python -m video_social_rtp.cli bronze
```
**ë¡œê·¸ í™•ì¸**:
```
INFO bronze_bloom_loaded size_bits=4790400 hash_count=7 count=12450
INFO bronze_appended_rows=49
```

#### Step 4: Silver ì§‘ê³„ (ë§¤ì¼)
```bash
python -m video_social_rtp.cli silver --once
```
**ë¡œê·¸ í™•ì¸**:
```
INFO silver_streaming_started watermark=10 minutes window=1 hour
INFO silver_batch_completed rows_written=156
```

#### Step 5: Gold í”¼ì²˜ ìƒì„± (ë§¤ì¼)
```bash
python -m video_social_rtp.cli gold --top-pct 0.9
```
**ì¶œë ¥ ì˜ˆì‹œ**:
```json
{
  "gold_rows": 3,
  "tier_distribution": {"1": 1, "2": 0, "3": 0, "4": 2},
  "cutoffs": {"tier1": 0.90, "tier2": 0.75, "tier3": 0.40}
}
```

#### Step 6: ëª¨ë¸ í•™ìŠµ (ì£¼ 1íšŒ, ì¼ìš”ì¼)
```bash
# MLflow í™œì„±í™” (ì¤‘ìš”!)
python -m video_social_rtp.cli train
```
**ë¡œê·¸ í™•ì¸**:
```
INFO mlflow_experiment=train_pareto tracking_uri=file://project/artifacts/mlruns
INFO model=LogisticRegression accuracy=0.85 f1=0.83 latency_ms=5.2
INFO model=RandomForest accuracy=0.92 f1=0.90 latency_ms=15.3
INFO pareto_models=1 saved_to=project/artifacts/pareto.json
```

#### Step 7: ëŒ€ì‹œë³´ë“œ ì‹¤í–‰
```bash
python -m video_social_rtp.cli ui --port 8501
```

---

### ğŸ“‹ ìë™í™” ìŠ¤í¬ë¦½íŠ¸ (Cron ì˜ˆì‹œ)

#### daily_pipeline.sh
```bash
#!/bin/bash
cd /home/student_15030/Bigdata_Proj
source .venv/bin/activate

# ë°ì´í„° ìˆ˜ì§‘
python -m video_social_rtp.cli fetch --query "NewJeans" --region-code KR
python -m video_social_rtp.cli fetch --query "BTS official" --region-code KR

# ì²˜ë¦¬
python -m video_social_rtp.cli bronze
python -m video_social_rtp.cli silver --once
python -m video_social_rtp.cli gold --top-pct 0.9

echo "Daily pipeline completed at $(date)"
```

#### weekly_train.sh
```bash
#!/bin/bash
cd /home/student_15030/Bigdata_Proj
source .venv/bin/activate

# ëª¨ë¸ ì¬í•™ìŠµ (MLflow í™œì„±í™”)
python -m video_social_rtp.cli train

echo "Weekly training completed at $(date)"
```

#### Crontab ì„¤ì •
```bash
# ë§¤ì¼ ì˜¤ì „ 9ì‹œ, ì˜¤í›„ 3ì‹œ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰
0 9,15 * * * /home/student_15030/Bigdata_Proj/daily_pipeline.sh

# ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 10ì‹œ ëª¨ë¸ ì¬í•™ìŠµ
0 10 * * 0 /home/student_15030/Bigdata_Proj/weekly_train.sh
```

---

## 7. ë¹„ì¦ˆë‹ˆìŠ¤ í™œìš©

### ğŸ’¼ Use Case 1: ë§ˆì¼€íŒ… íƒ€ì´ë° ìµœì í™”

**ì‹œë‚˜ë¦¬ì˜¤**: ì‹ ê³¡ ë°œë§¤ íƒ€ì´ë° ê²°ì •

**ë¶„ì„**:
```python
# NEWJEANS ìµœê·¼ íŠ¸ë Œë“œ
growth_7d = +45%
momentum = +30  # ê¸‰ìƒìŠ¹
trend_direction = "RISING"
```

**ì¸ì‚¬ì´íŠ¸**:
- í˜„ì¬ ì„±ì¥ ì¶”ì„¸ ê°•í•¨ â†’ **ì¦‰ì‹œ ì‹ ê³¡ ë°œë§¤ ê¶Œì¥**
- ì˜ˆìƒ Tier: 1 (ë°”ì´ëŸ´ ê°€ëŠ¥ì„± 85%)

---

### ğŸ’¼ Use Case 2: ê²½ìŸì‚¬ ë²¤ì¹˜ë§ˆí‚¹

**ì‹œë‚˜ë¦¬ì˜¤**: BLACKPINK vs BTS ë¹„êµ

| ì§€í‘œ | BLACKPINK | BTS |
|------|-----------|-----|
| Total Engagement | 926 | 281 |
| Tier | 1 | 4 |
| Growth Rate 7d | -2% | -5% |
| Trend | STEADY | FALLING |

**ì¸ì‚¬ì´íŠ¸**:
- BLACKPINK: ì„±ìˆ™ê¸° ì•ˆì •ì  ì¸ê¸° ìœ ì§€
- BTS: í•˜ë½ ì¶”ì„¸ â†’ ì»´ë°± ì „ëµ í•„ìš”

---

### ğŸ’¼ Use Case 3: ì‹ ì¸ ë°œêµ´

**ì‹œë‚˜ë¦¬ì˜¤**: ë– ì˜¤ë¥´ëŠ” ì‹ ì¸ ì•„í‹°ìŠ¤íŠ¸ ì¡°ê¸° ë°œê²¬

**ì¿¼ë¦¬**:
```python
rising_stars = df[
    (df['tier'] >= 3) &           # í˜„ì¬ ì¤‘í•˜ìœ„ê¶Œ
    (df['growth_rate_7d'] > 50) & # ê¸‰ì„±ì¥ ì¤‘
    (df['momentum'] > 20)          # ê°€ì†ë„ ë†’ìŒ
]
```

**ì¸ì‚¬ì´íŠ¸**:
- "RIIZE" growth_rate_7d = +78%, momentum = +35
- **ì˜ˆì¸¡**: 3ê°œì›” ë‚´ Tier 2 ì§„ì… ê°€ëŠ¥ì„± ë†’ìŒ
- **ì•¡ì…˜**: ì¡°ê¸° íˆ¬ì/í˜‘ì—… ê²€í† 

---

### ğŸ’¼ Use Case 4: ì½˜í…ì¸  ì „ëµ ìˆ˜ë¦½

**ì‹œë‚˜ë¦¬ì˜¤**: ì–´ë–¤ ìœ í˜•ì˜ ì½˜í…ì¸ ê°€ ë°”ì´ëŸ´ë˜ëŠ”ê°€?

**ë¶„ì„**:
```python
# Tier 1 ì•„í‹°ìŠ¤íŠ¸ ê³µí†µì 
tier1_artists = df[df['tier'] == 1]

# í‰ê·  í”¼ì²˜ ë¹„êµ
avg_videos = tier1_artists['total_videos'].mean()  # 35ê°œ
avg_engagement = tier1_artists['avg_engagement'].mean()  # 25.0
```

**ì¸ì‚¬ì´íŠ¸**:
- Tier 1 ë‹¬ì„± ì¡°ê±´: ì›” 30+ ì˜ìƒ, í‰ê·  engagement 20+
- **ì „ëµ**: ê³ ë¹ˆë„ ì—…ë¡œë“œ + ê³ í€„ë¦¬í‹° ìœ ì§€

---

## ğŸ“š ì°¸ê³  ìë£Œ

### ì•Œê³ ë¦¬ì¦˜ ìƒì„¸

- **Reservoir Sampling**: Vitter's Algorithm R (1985)
- **Bloom Filter**: Space-efficient probabilistic data structure
- **HyperLogLog**: Flajolet et al. (2007) cardinality estimation
- **Pareto Front**: Multi-objective optimization (non-dominated sorting)

### ê¸°ìˆ  ë¬¸ì„œ

- [PySpark Structured Streaming](https://spark.apache.org/docs/latest/structured-streaming-programming-guide.html)
- [Delta Lake Documentation](https://docs.delta.io/)
- [MLflow Tracking](https://mlflow.org/docs/latest/tracking.html)
- [YouTube Data API v3](https://developers.google.com/youtube/v3)

### í”„ë¡œì íŠ¸ ë¬¸ì„œ

- `docs/00_í”„ë¡œì íŠ¸_ê°œìš”_ë°_ì•„í‚¤í…ì²˜.md`
- `docs/01_ë°ì´í„°_ìˆ˜ì§‘_ë°_ë°°ì¹˜_ETL_ì„¤ê³„.md`
- `docs/02_ìŠ¤íŠ¸ë¦¬ë°_ë°ì´í„°_ì²˜ë¦¬_ì„¤ê³„.md`
- `docs/03_í”¼ì²˜_ì—”ì§€ë‹ˆì–´ë§_ë°_ë¼ë²¨ë§_ì„¤ê³„.md`
- `docs/04_ëª¨ë¸_í•™ìŠµ_ë°_ìµœì í™”_ì„¤ê³„.md`
- `docs/05_ì‹¤ì‹œê°„_ì˜ˆì¸¡_ì‹œìŠ¤í…œ_ì„¤ê³„.md`

---

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë°ì´í„° ìˆ˜ì§‘
- [ ] YouTube API í‚¤ ë°œê¸‰ ë° `.env` ì„¤ì •
- [ ] Landing ë””ë ‰í† ë¦¬ ìƒì„± (`scaffold`)
- [ ] ìµœì†Œ 7ì¼ ë°ì´í„° ìˆ˜ì§‘ (Bloom Filter ë™ì‘ ìœ„í•´)

### ë°ì´í„° ì²˜ë¦¬
- [ ] Bronze: Bloom Filter ì •ìƒ ë™ì‘ í™•ì¸
- [ ] Silver: Checkpoint ë””ë ‰í† ë¦¬ ìƒì„± í™•ì¸
- [ ] Gold: Tier ë¶„í¬ ê· í˜• í™•ì¸ (4ê°œ Tier ëª¨ë‘ ì¡´ì¬)

### ëª¨ë¸ í•™ìŠµ
- [ ] **MLflow í™œì„±í™”** (`--no-mlflow` ì‚¬ìš© ê¸ˆì§€!)
- [ ] MLflow UIì—ì„œ ì‹¤í—˜ ê²°ê³¼ í™•ì¸
- [ ] Pareto Front ëª¨ë¸ 1ê°œ ì´ìƒ ì„ íƒ í™•ì¸

### ì‹œê°í™”
- [ ] Streamlit UI ì •ìƒ ì‘ë™ í™•ì¸
- [ ] CDF/PDF ì°¨íŠ¸ ë Œë”ë§ í™•ì¸
- [ ] Bloom Filter ì¤‘ë³µ ì²´í¬ í…ŒìŠ¤íŠ¸

---

**ì‘ì„±ì**: Claude Code
**ìµœì¢… ìˆ˜ì •**: 2025-10-24
**ë²„ì „**: 1.0
**ë¬¸ì˜**: [GitHub Issues](https://github.com/umyunsang/Bigdata_Proj/issues)
